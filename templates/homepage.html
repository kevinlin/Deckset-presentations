{% extends "base.html" %}

{% block title %}Deckset Presentations{% endblock %}
{% block meta_description %}Browse a collection of Deckset presentations with {{ presentations|length }} available presentations{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Deckset Presentations</h1>
            <p class="text-gray-600">
                Found {{ presentations|length }} presentation{{ 's' if presentations|length != 1 else '' }}
            </p>
        </div>
        
        <div class="mt-4 md:mt-0">
            <div class="relative">
                <input type="text" id="search-input" placeholder="Search presentations..." 
                       class="w-full md:w-64 pl-10 pr-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </div>
            </div>
        </div>
    </div>
</div>

{% if presentations %}
<div id="presentations-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    {% for presentation in presentations %}
    <div class="presentation-card bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200 overflow-hidden">
        <a href="presentations/{{ presentation.folder_name }}.html" class="block">
            {% if presentation.preview_image %}
            <div class="aspect-w-16 aspect-h-9">
                <img src="{{ presentation.preview_image }}" 
                     alt="Preview of {{ presentation.title }}"
                     class="w-full h-48 object-cover"
                     loading="lazy">
            </div>
            {% else %}
            <div class="bg-gray-200 h-48 flex items-center justify-center">
                <div class="text-center text-gray-500">
                    <svg class="mx-auto h-12 w-12 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <p>No Preview</p>
                </div>
            </div>
            {% endif %}
        </a>
        
        <div class="p-6">
            <h3 class="text-xl font-semibold text-gray-900 mb-2 presentation-title">
                <a href="presentations/{{ presentation.folder_name }}.html" 
                   class="hover:text-blue-600 transition-colors">
                    {{ presentation.title }}
                </a>
            </h3>
            
            <div class="text-sm text-gray-600 space-y-1">
                <p>{{ presentation.slide_count }} slide{{ 's' if presentation.slide_count != 1 else '' }}</p>
                {% if presentation.last_modified %}
                <p>Updated: {{ presentation.last_modified.strftime('%Y-%m-%d') }}</p>
                {% endif %}
            </div>
            
            <div class="mt-4 flex justify-end">
                <a href="presentations/{{ presentation.folder_name }}.html" 
                   class="inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    View Presentation
                    <svg class="ml-1 -mr-0.5 h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                </a>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div id="no-results" class="hidden text-center py-12">
    <div class="text-gray-500">
        <svg class="mx-auto h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No matching presentations</h3>
        <p class="text-gray-600">Try adjusting your search criteria.</p>
    </div>
</div>
{% else %}
<div class="text-center py-12">
    <div class="text-gray-500">
        <svg class="mx-auto h-12 w-12 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">No presentations found</h3>
        <p class="text-gray-600">Add some Deckset presentations to get started.</p>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('search-input');
    const presentationCards = document.querySelectorAll('.presentation-card');
    const presentationsGrid = document.getElementById('presentations-grid');
    const noResults = document.getElementById('no-results');
    
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase().trim();
            let matchCount = 0;
            
            presentationCards.forEach(card => {
                const title = card.querySelector('.presentation-title').textContent.toLowerCase();
                if (title.includes(searchTerm)) {
                    card.classList.remove('hidden');
                    matchCount++;
                } else {
                    card.classList.add('hidden');
                }
            });
            
            // Show/hide no results message
            if (matchCount === 0 && searchTerm !== '') {
                presentationsGrid.classList.add('hidden');
                noResults.classList.remove('hidden');
            } else {
                presentationsGrid.classList.remove('hidden');
                noResults.classList.add('hidden');
            }
        });
    }
    
    // Add masonry layout for better visual presentation (optional)
    function resizeGridItems() {
        const grid = document.getElementById('presentations-grid');
        if (!grid) return;
        
        const rowHeight = 20;
        const rowGap = parseInt(window.getComputedStyle(grid).getPropertyValue('grid-row-gap'));
        
        const items = grid.querySelectorAll('.presentation-card');
        items.forEach(item => {
            const rowSpan = Math.ceil((item.getBoundingClientRect().height + rowGap) / (rowHeight + rowGap));
            item.style.gridRowEnd = 'span ' + rowSpan;
        });
    }
    
    // Initial resize and on window resize
    window.addEventListener('load', resizeGridItems);
    window.addEventListener('resize', resizeGridItems);
});
</script>
{% endblock %}